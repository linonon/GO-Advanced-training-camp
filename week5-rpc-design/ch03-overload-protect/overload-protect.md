# Overload Protect

令牌痛算法，按照固定速率往桶裡添加令牌。
- 假設限制 2r/s，則按照500ms 的固定速率往桶中添加令牌。
- 桶中最多存放b個令牌，當桶滿時，新添加的令牌被丟棄或拒絕。
- 當一個 n 個字節大小的數據包到達，將從桶中刪除 n個令牌，接著數據包被發送到網路上。
- 如果桶中的令牌不足 n 個， 則不會刪除令牌，且該數據包將被限流（要麼丟棄，要麼緩衝區等待）

![](/week5-rpc-design/pic/令牌桶.png)
<center>令牌桶</center>

漏桶算法：流量整形
- 一個固定容量的漏桶，按照常量固定速率流出水滴
- 如果桶空，則不需要流出水滴
- 可以以任意速率流入水滴到漏桶
- 如果流入超過容量，則溢出的被丟棄

![](/week5-rpc-design/pic/漏桶.png)
<center>漏桶</center>